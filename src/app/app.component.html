<!-- Toolbar -->
<div class="container-toolbar">
    <visualizer-toolbar 
        fxFlex="100%"
        *ngIf="projectData"
        (toggleFullScreen)="fullScreen = $event"
        [title]="projectData.title"
        [creator]="projectData.creator">
    </visualizer-toolbar>
</div>

<!-- Regular page content -->
<div *ngIf="!fullScreen" class="container-content">


    <div fxFlex fxLayout="row" fxLayout.sm="column" fxLayout.xs="column" fxLayoutAlign="space-around">

      <div *ngIf="data">

        <!-- Data -->
        <mat-accordion *ngIf="!textOnly">
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Triples
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div>
              <codemirror
                [(ngModel)]="data.triples"
                [config]="cmConfig">
              </codemirror>

              <div class="full-width" fxLayout="row">
                <button
                  mat-raised-button
                  color="primary"
                  (click)="doQuery()">
                  Update <mat-icon>play_circle_outline</mat-icon>
                </button>

                <button
                  mat-raised-button
                  (click)="resetTriples()">
                  Reset <mat-icon>cached</mat-icon>
                </button>
              </div>
            </div>

          </mat-expansion-panel>
        </mat-accordion>

        <!-- Query -->
        <query-field
          *ngIf="!textOnly"
          [reasoning]="data.reasoning"
          [query]="data.query"
          [tabIndex]="tabIndex"
          [localStore]="localStore"
          (doQuery)="doQuery()"
          (setReasoning)="reasoning = $event"
          (updatedQuery)="data.query = $event">
        </query-field>

        <!-- Result -->
        <div *ngIf="queryResult">

          <!-- CONSTRUCT -->
          <mat-accordion *ngIf="queryType == 'construct'">
            <mat-expansion-panel [expanded]="resultFieldExpanded">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Result
                </mat-panel-title>
              </mat-expansion-panel-header>

              <!-- Data visualization -->
              <app-sparql-force class="full-width" *ngIf="queryResult" (clickedURI)="graphClick($event)" [data]="queryResult" [height]="500"></app-sparql-force>
              <span *ngIf="!queryResult">No result to show</span>
            </mat-expansion-panel>
          </mat-accordion>

          <!-- SELECT -->
          <mat-accordion *ngIf="queryType == 'select'">
            <mat-expansion-panel [expanded]="resultFieldExpanded">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Result
                </mat-panel-title>
              </mat-expansion-panel-header>

              <!-- Data visualization -->
              <sparql-table
                maxHeight="500px"
                [queryResult]="queryResult"
                [queryTime]="queryTime"
                (clickedURI)="tableClick($event)">
              </sparql-table>
              <span *ngIf="!queryResult">No result to show</span>
            </mat-expansion-panel>
          </mat-accordion>
        </div>
      </div>

        <!-- Data tabs (tabs + description) -->
        <div *ngIf="!dataOnly" fxFlex="100%" fxFlex.md="40%" fxFlex.lg="40%" fxFlex.xl="40%">
            <mat-card class="mat-elevation-z2" >

                <p>
                    <span fxFlex="60%">Select dataset </span>
                    <span fxFlex="grow"></span>
                    <mat-icon 
                        *ngIf="triplestoreOption"
                        class="iconbutton" 
                        [matTooltip]="toggleTooltip"
                        (click)="toggleStore()">
                        swap_horiz
                    </mat-icon>
                </p>

<!--                &lt;!&ndash; Select &ndash;&gt;-->
<!--                <mat-form-field class="full-width">-->
<!--                    <mat-select placeholder="Dataset" (change)="changeTab($event.value)" [value]="tabIndex">-->
<!--                        &lt;!&ndash; <mat-option value="new">Add set...</mat-option> &ndash;&gt;-->
<!--                        <mat-option *ngFor="let title of tabTitles; let i = index" [value]="i">-->
<!--                            {{ title }}-->
<!--                        </mat-option>-->
<!--                    </mat-select>-->
<!--                </mat-form-field>-->

              <mat-form-field class="full-width">
                <mat-select placeholder="{{'NIE-Ontologies'}}" >
                  <mat-option *ngFor="let ontology of nieOntologies; let i = index"  (click)="getOntologies( ontology )">
                    {{ ontology.split('/')[ 7 ] }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <!-- Paste github link -->
              <mat-form-field class="full-width">
                <input matInput placeholder="Github Link" [(ngModel)]="githubLink" >
              </mat-form-field>

              <button mat-button *ngIf="githubLink" (click)="getOntologies()"> Get Ontologies </button><br>

              <span *ngIf="chosenOntology" >Chosen Ontology: {{ chosenOntology.split('/')[ 7 ] }}</span>

                <!-- Endpoint settings -->
                <div *ngIf="!localStore && data">
                    <app-settings [triples]="data.triples"></app-settings>
                </div>

                <div>
                    <span fxFlex="grow"></span>
                    <mat-icon 
                        class="iconbutton smallicon"
                        matTooltip="download JSON"
                        ngxClipboard 
                        [cbContent]="data | json"
                        (click)="showSnackbar('Copied JSON to clipboard', 2000)">
                        file_download
                    </mat-icon>
                </div>

            </mat-card>

        </div>

        <div *ngIf="loading" class="loading-spinner">
            <mat-spinner></mat-spinner>
            <p *ngIf="loadingMessage">{{loadingMessage}}</p>
        </div>

    </div>
</div>

<!-- Full screen mode -->
<div *ngIf="fullScreen">

    <div class="fullscreen-draggable" ngDraggable [handle]="DragArea">
        <div #DragArea class="fullscreen-toolbar"></div>
        <mat-accordion>

            <!-- Triples NB! This is a copy/paste - should be implemented properly -->
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        Triples
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <div>
                    <codemirror 
                        [(ngModel)]="data.triples"
                        [config]="cmConfig">
                    </codemirror>

                    <div class="full-width" fxLayout="row">
                        <button 
                            mat-raised-button 
                            color="primary" 
                            (click)="doQuery()">
                            Update <mat-icon>play_circle_outline</mat-icon>
                        </button>

                        <button 
                            mat-raised-button 
                            (click)="resetTriples()">
                            Reset <mat-icon>cached</mat-icon>
                        </button>
                    </div>
                </div>
            </mat-expansion-panel>

            <!-- Query -->
            <query-field 
                [reasoning]="data.reasoning"
                [query]="data.query" 
                [tabIndex]="tabIndex"
                [localStore]="localStore"
                (doQuery)="doQuery()"
                (setReasoning)="reasoning = $event"
                (updatedQuery)="data.query = $event">
            </query-field>

        </mat-accordion>
    </div>
    
    <!-- Graph -->
    <div *ngIf="queryType == 'construct'" class="fullscreen-canvas">
        <app-sparql-force *ngIf="queryResult" (clickedURI)="graphClick($event)" [data]="queryResult"></app-sparql-force>
    </div>

    <!-- Table -->
    <sparql-table
        *ngIf="queryType == 'select'"
        [queryResult]="queryResult"
        [queryTime]="queryTime"
        (clickedURI)="tableClick($event)">
    </sparql-table>

</div>
